#: import AKCircularProgress akivymd.uix.progresswidget
#include force Power_App_KVs/meter_reading_details.kv
# import AKBadgeLayout akivymd.uix.akbadgelayout
<Meter_reading_screen>:
    on_leave: app.meter_reading_clear_items()
    on_enter: app.meter_reading_menu_items()
    MDBoxLayout:
        size_hint_y: 0.94
        orientation: "vertical"
        MDCard:
            size_hint: 1,.06
            orientation: "horizontal"
            spacing: "5dp"
            padding: "10dp"
            MDLabel:
                text: "Sept Cycle"
                font_size: "10dp"
                halign: "left"
            MDLabel:
                size_hint: .3,1
                text: "BU"
                font_size: "10dp"

        MDCard:
            id: dss_and_progress_bar
            padding_x: 0
            spacing: 5
            size_hint: 1,.1
            orientation: "horizontal"
            AnchorLayout:
			    pos_hint: {'center_x': .5, 'center_y': .5}
				size_hint: (1, 1)
				#height: dp(30)
				#width: dp(200)

                TextInput:
                    id: meter_dss_selector
                    padding: ["1dp","8dp"]
                    pos_hint: None, None
                    x: self.parent.x
                    y: self.parent.y
                    size_hint_x: 1
                    text: ""
                    font_size: "12dp"
                    multiline: False
                    on_text: app.transformer_selector_1(self.text), root.clear_label()
                    on_text: meter_dss_selector.border = (0, 4, 4, 4)
                    MDLabel:
                        id: faker0
                        padding: ["12dp","12dp"]
                        pos_hint: meter_dss_selector.x, meter_dss_selector.y
                        size_hint: None, None
                        size: meter_dss_selector.width, meter_dss_selector.height
                        text: ""
                        font_size: "9dp"
                        on_touch_down: app.transformer_selector_1(meter_dss_selector.text)


                    #, reading_progress_percent.current_percent = len(self.text)#self.text)
                MDLabel:
                    id: faker1
                    padding: ["12dp","12dp"]
                    pos_hint: meter_dss_selector.x, meter_dss_selector.y
                    size_hint: None, None
                    size: meter_dss_selector.width, meter_dss_selector.height
                    text: "Enter DSS name"
                    font_size: "9dp"


                MDGridLayout:
                    id: grider
                    cols: 2
                    size_hint: None, None
                    width: meter_dss_selector.width/3
                    height: meter_dss_selector.height
                    pos_hint: None, None
                    x: meter_dss_selector.x+(meter_dss_selector.width/3)+(meter_dss_selector.width/3)#(meter_dss_selector.x-filter_button.width)
                    #x:meter_dss_selector.x
                    #y:meter_dss_selector.y
                    canvas.after:
                        Rectangle:
                            pos: grider.pos
                        Color:
                            rgba: 0,0,1,1

                    MDFlatButton:
                        id: filter_button
                        size_hint: .9, 1
                        #width: self.parent.width*0.9
                        #padding: ["12dp","12dp"]
                        text: "Filter"
                        md_bg_color: 1,0,0,1
                        font_size: "8dp"
                    MDCheckbox:
                        id: checker
                        size_hint: .1, 1
                        #width: self.parent.width*0.1
                        #pos_hint: {"top": 1, "right": 1}
                        on_active: app.nothing()
                        canvas.after:
                            Rectangle:
                                pos: self.parent.pos
                            Color:
                                rgba: 1,1,0,1

            MDBoxLayout:
                id: progress_bar_main_layout
                size_hint_x: 0.2
                AKCircularProgress:
                    id: meter_read_progress
                    pos_hint: {"center_x": .5, "center_y": .5}
                    size_hint: (None, None)
                    size: ('40dp', '40dp')
                    line_width: '2dp'
                    percent_type: "relative"
                    percent_size: '7dp'
                    start_deg: 180
                    end_deg: 540
                    max_percent: 1
                    #current_percent: 0

        Screen:
            ScrollView:
                on_touch_down: dss_scrollview.clear_widgets()
                do_scroll_y: True
                MDGridLayout:
                    id: meter_read_grid
                    md_bg_color: [.7]+app.theme_cls.primary_light[1:3]+[.4]
                    padding: 3
                    spacing: 5
                    size_hint: 1,None
                    height: app.widget_sizer(id="meter_to_read_height", parent_height=self.parent.height, child_number=len(self.children))
                    cols: 1
                    #the upload function should work in a way that will change the color of the meters to read
                    #to white when read but should be at yellow before read, it should also change the color to green if the upload is successful
                    #Meters_to_read:
                    MDLabel:
                        orientation: "horizontal"
                        size_hint: 1, .3
                        MDLabel:
                            size_hint: .7, 1
                            text: "Download all or use the search bar above to select multiple or separate DSS"
                            font_size: "14dp"
                        #MDCard:
                            #size_hint: .3, 1
                        MDFillRoundFlatButton:
                            text: "Download"
                            on_press: app.meter_reading_clear_items(), app.meter_reading_menu_items()


            MDFloatLayout:
                id: bottom_tab
                md_bg_color: [.6]+app.theme_cls.primary_light[1:3]+[0]
                size_hint: 1, .1
                spacing: 5
                padding: 5
                MDFloatLayout:
                    id: dss_scrollview
                    pos: meter_dss_selector.x, meter_dss_selector.y
                    size_hint: None, None
                    width: meter_dss_selector.width


                MDBoxLayout:
                    orientation: "horizontal"
                    padding:[5,5] if root.width < root.height else [15,15]
                    spacing: 5 if root.width < root.height else 15
                    Button:
                        text: "Upload All"
                        font_size: "9dp"
                        icon: "upload-multiple"
                        pos_hint: {"bottom":1, "left": .5}
                        #size_hint_x: .2
                        size_hint: .3, 1
                        background_color: app.theme_cls.primary_dark

                    Button:
                        pos_hint: {"center_x": .5}
                        font_size: "9dp"
                        text: "Manual Input"
                        icon: "animation"
                        on_release: app.change_screen('Meter reading page',step=2)
                        size_hint: .3,1
                        size: 70, 30
                        background_color: app.theme_cls.primary_dark

                    Button:
                        pos_hint: {"center_x": .5}
                        font_size: "9dp"
                        text: "Show all read"
                        icon: "animation"
                        on_release: app.manual_meter_reading()#, print(app.theme_cls.primary_light)
                        #size_hint_x: .2
                        size_hint: .3,1
                        background_color: app.theme_cls.primary_dark

<manual_reading_dialog@MDCard>:
    MDGridLayout:
        cols: 2
        padding: 10
        MDLabel:
            text: "Enter Account here:"
        MDTextField:
            font_size: "12dp"
        MDLabel:
            text: "Enter Reading:"
        MDTextField:
            font_size: "12dp"
    MDGridLayout:
        cols: 2
        padding: 15
        spacing: 20
        MDFillRoundFlatButton:
            text: "Cancel"
        MDFillRoundFlatButton:
            text: "Save"

