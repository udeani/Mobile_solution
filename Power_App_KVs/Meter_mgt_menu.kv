#: import AKCircularProgress akivymd.uix.progresswidget
#include force Power_App_KVs/meter_reading_details.kv
# import AKBadgeLayout akivymd.uix.akbadgelayout
<Meter_reading_screen>:
    on_enter: root.meter_reading_status(), root.check_last_read()

    MDBoxLayout:
        id: top_widget
        size_hint_y: 0.96
        orientation: "vertical"
        #padding: "25sp"
        MDCard:
            size_hint_x: 1
            height: "50dp" if app.orientation_checker(top_widget.width, top_widget.height) else "38dp"
            orientation: "vertical" if app.orientation_checker(top_widget.width, top_widget.height) else "horizontal"
            padding: "5dp"

            # first segment that has the SU and BU name
            MDGridLayout:
                cols: 2
                #size_hint: [1, .04] if app.orientation_checker(top_widget.width, top_widget.height) else [.3,1]
                #size_hint_y: 0
                height: "12sp"
                MDLabel:
                    id: read_cycle
                    text: ""
                    font_size: "8sp"
                    halign: "center"

            # second segment that have search bar
            MDGridLayout:
                id: searchgrid
                cols: 2
                height: "38sp"
                AnchorLayout:
                    pos_hint: searchgrid.pos
				    size_hint_y: 1
				    size_hint_x: 1
				    anchor_x: "right"
                    TextInput:
                        id: meter_dss_selector
                        #padding: ["1sp","1sp"]
                        pos_hint: None, None
                        x: self.parent.x
                        y: self.parent.y
                        text: ""
                        multiline: False
                        on_text: root.transformer_selector(self.text), root.dss_selector_clear_label()
                        on_text: meter_dss_selector.border = (0, 4, 4, 4)
                        MDLabel:
                            id: faker0
                            padding: ["12sp","12sp"]
                            pos_hint: meter_dss_selector.x, meter_dss_selector.y
                            size_hint: None, None
                            size: meter_dss_selector.width, meter_dss_selector.height
                            text: ""
                            font_size: "9sp"
                            on_touch_down: root.transformer_selector(meter_dss_selector.text)

                    MDLabel:
                        id: faker1
                        padding: ["12sp","12sp"]
                        pos_hint: meter_dss_selector.x, meter_dss_selector.y
                        size_hint: None, None
                        size: meter_dss_selector.width, meter_dss_selector.height
                        text: "Enter DSS to filter"
                        font_size: "9sp"

                    MDGridLayout:
                        id: grider1
                        cols: 2
                        size_hint: None, None
                        width: meter_dss_selector.width/4
                        height: meter_dss_selector.height
                        pos_hint: None, 1
                        anchor_x: "right"
                        pos: meter_dss_selector.x+(meter_dss_selector.width/3)+(meter_dss_selector.width/3), meter_dss_selector.y

                        Button:
                            id: filter_button
                            size_hint: .6, 1
                            text: "Load All"
                            background_color: app.theme_cls.primary_dark
                            on_release: root.meter_reading_filter()
                            font_size: "9sp"
                AnchorLayout:
                    pos_hint: searchgrid.pos
				    size_hint_x: 1
				    size_hint_y: 1
				    anchor_x: "right"
				    padding: "22sp"
                    MDTextFieldRound:
                        id: account_filter
                        #padding: ["1sp","1sp"]
                        pos_hint: None, None
                        x: self.parent.x
                        y: self.parent.y
                        text: ""
                        on_text: root.meter_read_filter_by_acc(self.text)
                        multiline: False
                        MDLabel:
                            id: account_search_faker0
                            padding: ["12sp","12sp"]
                            pos_hint: meter_dss_selector.x, meter_dss_selector.y
                            size_hint: None, None
                            size: meter_dss_selector.width, meter_dss_selector.height
                            text: ""
                            #font_size: "9dp"
                            #on_touch_down: root.transformer_selector(meter_dss_selector.text)

        Screen:
            size_hint: [1,0.85]
            ScrollView:
                on_touch_down: root.transformer_selector_clear_items()
                #on_touch_down: self.dss_checkbox_filter = []
                #on_touch_down: app.dss_search_text_state = "Load All"
                do_scroll_y: True
                MDGridLayout:
                    id: meter_read_grid
                    md_bg_color: [.7]+app.theme_cls.primary_light[1:3]+[.4]
                    padding: "5sp"
                    spacing: "5sp"
                    size_hint: 1,None
                    height: app.widget_sizer(id="meter_to_read_height", parent_height=self.parent.height, child_number=len(self.children))
                    cols: 1 if app.orientation_checker(top_widget.width, top_widget.height) else 2
                    #the upload function should work in a way that will change the color of the meters to read
                    #to white when read but should be at yellow before read, it should also change the color to green if the upload is successful
                    #Meters_to_read:
                    # this is the section that contains all the added meters to read

            MDFloatLayout:
                id: bottom_tab
                md_bg_color: [.6]+app.theme_cls.primary_light[1:3]+[0]
                size_hint: [1, .2]
                #spacing: 5
                padding: 5
                MDFloatLayout:
                    id: dss_scrollview
                    pos: meter_dss_selector.x, meter_dss_selector.y
                    size_hint: None, None
                    width: meter_dss_selector.width
                MDBoxLayout:
                    id: bottom_buttons
                    orientation: "vertical"

                    MDBoxLayout:
                        orientation: "horizontal"
                        #padding_y: "15sp"
                        #padding_x: "5sp"
                        spacing: "5sp" if app.orientation_checker(top_widget.width, top_widget.height) else "15sp"

                        Widget:
                            size_hint: .3,.4 if app.orientation_checker(top_widget.width, top_widget.height) else [.2, .4]

                        Button:
                            pos_hint: {"center_x": .5}
                            text: "Manual Input"
                            on_release: app.change_screen('Meter reading page',step=2)
                            size_hint: .3,.4 if app.orientation_checker(top_widget.width, top_widget.height) else [.2, .4]
                            background_color: app.theme_cls.primary_dark

                        Button:
                            pos_hint: {"center_x": .5}
                            text: "Show all read"
                            #on_release: app.manual_meter_reading()
                            size_hint: .3,.4 if app.orientation_checker(top_widget.width, top_widget.height) else [.2, .4]
                            background_color: app.theme_cls.primary_dark
                        Widget:
                            size_hint: .3,.4 if app.orientation_checker(top_widget.width, top_widget.height) else [.2, .4]